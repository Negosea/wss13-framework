<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSS+13 Framework - Dashboard Profissional</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-radius: 12px;
            --box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .main-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }

        .agents-section {
            margin-bottom: 40px;
        }

        .section-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--dark-color);
        }

        .section-title h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .section-title p {
            color: #666;
            font-size: 1.1rem;
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .agent-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .agent-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .agent-card:hover::before {
            left: 100%;
        }

        .agent-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .agent-avatar {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .agent-card h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .agent-card p {
            opacity: 0.9;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .agent-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        .form-section {
            background: var(--light-color);
            padding: 30px;
            border-radius: var(--border-radius);
            margin: 30px 0;
            border: 1px solid #e9ecef;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group input {
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .buttons-section {
            margin: 30px 0;
        }

        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-complete {
            background: linear-gradient(135deg, var(--success-color) 0%, #20c997 100%);
            color: white;
            grid-column: 1 / -1;
            font-size: 1.1rem;
            padding: 18px 30px;
        }

        .btn-complete:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }

        .progress-section {
            margin: 30px 0;
            display: none;
        }

        .progress-section.show {
            display: block;
        }

        .analysis-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            flex: 1;
            position: relative;
        }

        .progress-step::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 60%;
            width: 80%;
            height: 2px;
            background: #e9ecef;
            z-index: 1;
        }

        .progress-step:last-child::after {
            display: none;
        }

        .progress-step.completed::after {
            background: var(--success-color);
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 2;
            position: relative;
        }

        .progress-step.pending .step-icon {
            background: #e9ecef;
            color: #6c757d;
        }

        .progress-step.active .step-icon {
            background: var(--warning-color);
            color: white;
            animation: pulse 1.5s infinite;
        }

        .progress-step.completed .step-icon {
            background: var(--success-color);
            color: white;
        }

        .step-label {
            font-size: 0.9rem;
            font-weight: 600;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            margin: 30px 0;
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .results-grid {
            display: grid;
            gap: 20px;
        }

        .agent-result-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            border-left: 4px solid var(--primary-color);
            transition: var(--transition);
        }

        .agent-result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .agent-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .agent-avatar-result {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .agent-info {
            flex: 1;
        }

        .agent-info h4 {
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: var(--dark-color);
        }

        .agent-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.approved {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            background: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            transition: var(--transition);
        }

        .metric-card:hover {
            background: #e9ecef;
        }

        .metric-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #666;
        }

        .recommendation {
            background: #e8f5e8;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            border-left: 4px solid var(--success-color);
        }

        .recommendation h5 {
            color: var(--success-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .charts-section {
            margin: 30px 0;
            display: none;
        }

        .charts-section.show {
            display: block;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .chart-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .chart-title {
            text-align: center;
            margin-bottom: 15px;
            color: var(--dark-color);
            font-weight: 600;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 40px;
        }

        .footer p {
            margin-bottom: 5px;
        }

        .api-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                padding: 20px;
            }

            .agents-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .buttons-grid {
                grid-template-columns: 1fr;
            }

            .analysis-progress {
                flex-direction: column;
                gap: 20px;
            }

            .progress-step::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-building"></i> WSS+13 Framework</h1>
            <p>Dashboard Profissional - Ecossistema de Agentes IA</p>
            <div class="status-bar">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Sistema Online</span>
                </div>
                <div class="status-indicator">
                    <i class="fas fa-robot"></i>
                    <span>5 Agentes Ativos</span>
                </div>
                <div class="status-indicator">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard v2.0</span>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="agents-section">
                <div class="section-title">
                    <h2><i class="fas fa-users"></i> Nossos Especialistas</h2>
                    <p>Equipe de agentes IA especializados em constru√ß√£o civil</p>
                </div>
                
                <div class="agents-grid">
                    <div class="agent-card">
                        <div class="agent-avatar">üèóÔ∏è</div>
                        <h3>Breno Silva</h3>
                        <p><strong>Engenheiro Estrutural</strong></p>
                        <p>CREA-SP 123456/D</p>
                        <p>25 anos de experi√™ncia</p>
                        <div class="agent-badge">Especialista em Funda√ß√µes</div>
                    </div>
                    
                    <div class="agent-card">
                        <div class="agent-avatar">üí∞</div>
                        <h3>Paulo Mendes</h3>
                        <p><strong>Analista Financeiro</strong></p>
                        <p>CRC-SP 654321</p>
                        <p>15 anos de experi√™ncia</p>
                        <div class="agent-badge">Especialista em Or√ßamentos</div>
                    </div>
                    
                    <div class="agent-card">
                        <div class="agent-avatar">üë∑</div>
                        <h3>Jos√© Silva</h3>
                        <p><strong>Mestre de Obras</strong></p>
                        <p>SINDUSCON-SP 789123</p>
                        <p>20 anos de experi√™ncia</p>
                        <div class="agent-badge">Especialista em Execu√ß√£o</div>
                    </div>
                    
                    <div class="agent-card">
                        <div class="agent-avatar">‚ö†Ô∏è</div>
                        <h3>Ricardo Prote√ß√£o</h3>
                        <p><strong>Eng. Seguran√ßa</strong></p>
                        <p>CREA-SP 456789/D</p>
                        <p>18 anos de experi√™ncia</p>
                        <div class="agent-badge">Especialista em NR-18</div>
                    </div>
                    
                    <div class="agent-card">
                        <div class="agent-avatar">üíº</div>
                        <h3>Helena Vendas</h3>
                        <p><strong>Diretora Comercial</strong></p>
                        <p>CRA-SP 987321</p>
                        <p>12 anos de experi√™ncia</p>
                        <div class="agent-badge">Especialista em Mercado</div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-title">
                    <h2><i class="fas fa-clipboard-list"></i> An√°lise de Projeto</h2>
                    <p>Preencha os dados do seu projeto para an√°lise completa</p>
                </div>
                
                <form id="projectForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="projectName">
                                <i class="fas fa-home"></i>
                                Nome do Projeto:
                            </label>
                            <input type="text" id="projectName" name="name" required placeholder="Ex: Resid√™ncia Familiar Silva">
                        </div>
                        
                        <div class="form-group">
                            <label for="area">
                                <i class="fas fa-ruler-combined"></i>
                                √Årea (m¬≤):
                            </label>
                            <input type="number" id="area" name="area" required placeholder="Ex: 120" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="structuralLoad">
                                <i class="fas fa-weight-hanging"></i>
                                Carga Estrutural (kN):
                            </label>
                            <input type="number" id="structuralLoad" name="structural_load" required placeholder="Ex: 600" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="soilTension">
                                <i class="fas fa-mountain"></i>
                                Tens√£o do Solo (kPa):
                            </label>
                            <input type="number" id="soilTension" name="soil_tension" required placeholder="Ex: 45" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="budget">
                                <i class="fas fa-dollar-sign"></i>
                                Or√ßamento (R$) - Opcional:
                            </label>
                            <input type="number" id="budget" name="budget" placeholder="Ex: 300000" min="0">
                        </div>
                    </div>

                    <div class="buttons-section">
                        <div class="section-title">
                            <h3><i class="fas fa-play"></i> An√°lises Individuais</h3>
                        </div>
                        
                        <div class="buttons-grid">
                            <button type="button" class="btn btn-primary" onclick="analyzeAgent('structural')">
                                <i class="fas fa-building"></i>
                                An√°lise Estrutural
                            </button>
                            <button type="button" class="btn btn-primary" onclick="analyzeAgent('financial')">
                                <i class="fas fa-chart-line"></i>
                                An√°lise Financeira
                            </button>
                            <button type="button" class="btn btn-primary" onclick="analyzeAgent('construction')">
                                <i class="fas fa-hard-hat"></i>
                                An√°lise de Obra
                            </button>
                            <button type="button" class="btn btn-primary" onclick="analyzeAgent('safety')">
                                <i class="fas fa-shield-alt"></i>
                                An√°lise de Seguran√ßa
                            </button>
                            <button type="button" class="btn btn-primary" onclick="analyzeAgent('commercial')">
                                <i class="fas fa-handshake"></i>
                                An√°lise Comercial
                            </button>
                            <button type="button" class="btn btn-complete" onclick="analyzeComplete()">
                                <i class="fas fa-rocket"></i>
                                An√°lise Completa - Todos os Agentes
                            </button>
                        </div>
                    </div>
                </form>

                <div class="progress-section" id="progressSection">
                    <div class="section-title">
                        <h3><i class="fas fa-tasks"></i> Progresso da An√°lise</h3>
                    </div>
                    <div class="analysis-progress" id="analysisProgress">
                        <div class="progress-step pending" id="step-structural">
                            <div class="step-icon">üèóÔ∏è</div>
                            <div class="step-label">Estrutural</div>
                        </div>
                        <div class="progress-step pending" id="step-financial">
                            <div class="step-icon">üí∞</div>
                            <div class="step-label">Financeiro</div>
                        </div>
                        <div class="progress-step pending" id="step-construction">
                            <div class="step-icon">üë∑</div>
                            <div class="step-label">Constru√ß√£o</div>
                        </div>
                        <div class="progress-step pending" id="step-safety">
                            <div class="step-icon">‚ö†Ô∏è</div>
                            <div class="step-label">Seguran√ßa</div>
                        </div>
                        <div class="progress-step pending" id="step-commercial">
                            <div class="step-icon">üíº</div>
                            <div class="step-label">Comercial</div>
                        </div>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <h3><i class="fas fa-cog fa-spin"></i> Processando An√°lise...</h3>
                    <p>Nossos agentes est√£o analisando seu projeto</p>
                </div>

                <div class="results-section" id="results">
                    <div class="section-title">
                        <h2><i class="fas fa-chart-bar"></i> Resultados da An√°lise</h2>
                        <p>Relat√≥rio detalhado dos nossos especialistas</p>
                    </div>
                    <div class="results-grid" id="resultsContent"></div>
                </div>

                <div class="charts-section" id="chartsSection">
                    <div class="section-title">
                        <h2><i class="fas fa-chart-pie"></i> Dashboard de M√©tricas</h2>
                        <p>Visualiza√ß√£o gr√°fica dos resultados</p>
                    </div>
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-title">Distribui√ß√£o de Custos</div>
                            <canvas id="costChart" width="300" height="200"></canvas>
                        </div>
                        <div class="chart-card">
                            <div class="chart-title">Timeline de Execu√ß√£o</div>
                            <canvas id="timelineChart" width="300" height="200"></canvas>
                        </div>
                        <div class="chart-card">
                            <div class="chart-title">An√°lise de Riscos</div>
                            <canvas id="riskChart" width="300" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="api-links">
                <a href="/docs" class="btn btn-secondary">
                    <i class="fas fa-book"></i>
                    Documenta√ß√£o da API
                </a>
                <a href="/health" class="btn btn-secondary">
                    <i class="fas fa-heartbeat"></i>
                    Status do Sistema
                </a>
            </div>
        </div>

        <div class="footer">
            <p><i class="fas fa-code"></i> Desenvolvido por <strong>Marcos Sea</strong></p>
            <p>WSS+13 Framework - Revolucionando a Constru√ß√£o Civil com IA</p>
            <p><i class="fas fa-calendar"></i> Dashboard v2.0 - 2025</p>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let currentAnalysisType = '';
        let analysisResults = {};

        // Fun√ß√£o para coletar dados do formul√°rio
        function getFormData() {
            const form = document.getElementById('projectForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    data[key] = isNaN(value) ? value : Number(value);
                }
            }
            
            return data;
        }

        // Fun√ß√£o para mostrar loading
        function showLoading() {
            document.getElementById('loading').classList.add('show');
            document.getElementById('results').classList.remove('show');
            document.getElementById('chartsSection').classList.remove('show');
        }

        // Fun√ß√£o para esconder loading
        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
        }

        // Fun√ß√£o para atualizar progresso
        function updateProgress(step, status) {
            const stepElement = document.getElementById(`step-${step}`);
            if (stepElement) {
                stepElement.className = `progress-step ${status}`;
            }
            document.getElementById('progressSection').classList.add('show');
        }

        // Fun√ß√£o para resetar progresso
        function resetProgress() {
            const steps = ['structural', 'financial', 'construction', 'safety', 'commercial'];
            steps.forEach(step => {
                const stepElement = document.getElementById(`step-${step}`);
                if (stepElement) {
                    stepElement.className = 'progress-step pending';
                }
            });
        }

        // Fun√ß√£o para criar card de resultado
        function createResultCard(data) {
            const agentIcons = {
                'structural': 'üèóÔ∏è',
                'financial': 'üí∞',
                'construction': 'üë∑',
                'safety': '‚ö†Ô∏è',
                'commercial': 'üíº'
            };

            const agentNames = {
                'structural': 'Breno Silva',
                'financial': 'Paulo Mendes',
                'construction': 'Jos√© Silva',
                'safety': 'Ricardo Prote√ß√£o',
                'commercial': 'Helena Vendas'
            };

            const statusClass = data.analysis?.status === 'approved' ? 'approved' : 
                               data.analysis?.status === 'warning' ? 'warning' : 'rejected';

            return `
                <div class="agent-result-card">
                    <div class="agent-header">
                        <div class="agent-avatar-result">
                            ${agentIcons[data.agent] || 'ÔøΩÔøΩ'}
                        </div>
                        <div class="agent-info">
                            <h4>${data.agent_name || agentNames[data.agent] || 'Agente IA'}</h4>
                            <p>${data.agent_role || 'Especialista'}</p>
                        </div>
                        <div class="status-badge ${statusClass}">
                            ${data.analysis?.status || 'Analisado'}
                        </div>
                    </div>
                    
                    <div class="metrics-grid">
                        ${createMetrics(data)}
                    </div>
                    
                    <div class="recommendation">
                        <h5><i class="fas fa-lightbulb"></i> Recomenda√ß√£o:</h5>
                        <p>${data.analysis?.observations || 'An√°lise conclu√≠da com sucesso'}</p>
                    </div>
                </div>
            `;
        }

        // Fun√ß√£o para criar m√©tricas
        function createMetrics(data) {
            let metrics = '';
            
            if (data.analysis) {
                Object.entries(data.analysis).forEach(([key, value]) => {
                    if (key !== 'observations' && key !== 'status') {
                        const icon = getMetricIcon(key);
                        const label = getMetricLabel(key);
                        
                        metrics += `
                            <div class="metric-card">
                                <div class="metric-icon">${icon}</div>
                                <div class="metric-value">${value}</div>
                                <div class="metric-label">${label}</div>
                            </div>
                        `;
                    }
                });
            }
            
            return metrics;
        }

        // Fun√ß√£o para obter √≠cone da m√©trica
        function getMetricIcon(key) {
            const icons = {
                'structural_load': '‚öñÔ∏è',
                'soil_tension': 'üèîÔ∏è',
                'foundation_type': 'üèóÔ∏è',
                'safety_factor': 'üõ°Ô∏è',
                'budget_analysis': 'üí∞',
                'cost_per_m2': 'üìä',
                'construction_time': '‚è∞',
                'team_size': 'üë•',
                'risk_level': '‚ö†Ô∏è',
                'market_value': 'üíé',
                'sales_forecast': 'üìà'
            };
            return icons[key] || 'üìã';
        }

        // Fun√ß√£o para obter label da m√©trica
        function getMetricLabel(key) {
            const labels = {
                'structural_load': 'Carga Estrutural',
                'soil_tension': 'Tens√£o do Solo',
                'foundation_type': 'Tipo de Funda√ß√£o',
                'safety_factor': 'Fator de Seguran√ßa',
                'budget_analysis': 'An√°lise Or√ßament√°ria',
                'cost_per_m2': 'Custo por m¬≤',
                'construction_time': 'Tempo de Obra',
                'team_size': 'Equipe',
                'risk_level': 'N√≠vel de Risco',
                'market_value': 'Valor de Mercado',
                'sales_forecast': 'Previs√£o de Vendas'
            };
            return labels[key] || key.replace('_', ' ');
        }

        // Fun√ß√£o para mostrar resultados
        function showResults(data) {
            hideLoading();
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultsContent');
            
            if (Array.isArray(data)) {
                // M√∫ltiplos agentes
                contentDiv.innerHTML = data.map(result => createResultCard(result)).join('');
                createCharts(data);
            } else {
                // Agente √∫nico
                contentDiv.innerHTML = createResultCard(data);
                updateProgress(data.agent, 'completed');
            }
            
            resultsDiv.classList.add('show');
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Fun√ß√£o para criar gr√°ficos
        function createCharts(data) {
            document.getElementById('chartsSection').classList.add('show');
            
            // Gr√°fico de custos
            const costCtx = document.getElementById('costChart').getContext('2d');
            new Chart(costCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Material', 'M√£o de Obra', 'Equipamentos', 'Outros'],
                    datasets: [{
                        data: [40, 35, 15, 10],
                        backgroundColor: ['#667eea', '#764ba2', '#28a745', '#ffc107']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Gr√°fico de timeline
            const timelineCtx = document.getElementById('timelineChart').getContext('2d');
            new Chart(timelineCtx, {
                type: 'bar',
                data: {
                    labels: ['Funda√ß√£o', 'Estrutura', 'Veda√ß√£o', 'Acabamento'],
                    datasets: [{
                        label: 'Meses',
                        data: [3, 4, 5, 5],
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Gr√°fico de riscos
            const riskCtx = document.getElementById('riskChart').getContext('2d');
            new Chart(riskCtx, {
                type: 'radar',
                data: {
                    labels: ['Estrutural', 'Financeiro', 'Cronograma', 'Seguran√ßa', 'Mercado'],
                    datasets: [{
                        label: 'N√≠vel de Risco',
                        data: [2, 3, 4, 1, 3],
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para analisar com um agente espec√≠fico
        async function analyzeAgent(agentType) {
            const data = getFormData();
            
            if (!data.name || !data.area || !data.structural_load || !data.soil_tension) {
                alert('Por favor, preencha todos os campos obrigat√≥rios!');
                return;
            }

            currentAnalysisType = agentType;
            resetProgress();
            updateProgress(agentType, 'active');
            showLoading();

            try {
                const response = await fetch(`/analyze/${agentType}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error(`Erro: ${response.status}`);
                }

                const result = await response.json();
                analysisResults[agentType] = result;
                showResults(result);
            } catch (error) {
                hideLoading();
                updateProgress(agentType, 'rejected');
                alert(`Erro na an√°lise: ${error.message}`);
            }
        }

        // Fun√ß√£o para an√°lise completa
        async function analyzeComplete() {
            const data = getFormData();
            
            if (!data.name || !data.area || !data.structural_load || !data.soil_tension) {
                alert('Por favor, preencha todos os campos obrigat√≥rios!');
                return;
            }

            currentAnalysisType = 'complete';
            resetProgress();
            showLoading();

            // Simular progresso sequencial
            const agents = ['structural', 'financial', 'construction', 'safety', 'commercial'];
            
            try {
                // Atualizar progresso visualmente
                for (let i = 0; i < agents.length; i++) {
                    updateProgress(agents[i], 'active');
                    await new Promise(resolve => setTimeout(resolve, 500));
                }

                const response = await fetch('/analyze/complete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error(`Erro: ${response.status}`);
                }

                const result = await response.json();
                
                // Marcar todos como completos
                agents.forEach(agent => updateProgress(agent, 'completed'));
                
                analysisResults = result;
                showResults(result);
            } catch (error) {
                hideLoading();
                alert(`Erro na an√°lise: ${error.message}`);
            }
        }

        // Verificar status da API ao carregar a p√°gina
        window.addEventListener('load', async function() {
            try {
                const response = await fetch('/health');
                const health = await response.json();
                console.log('API Status:', health);
            } catch (error) {
                console.error('API n√£o est√° respondendo:', error);
                // Atualizar indicador de status
                const statusDot = document.querySelector('.status-dot');
                if (statusDot) {
                    statusDot.style.background = '#dc3545';
                }
            }
        });
    </script>
</body>
</html>
